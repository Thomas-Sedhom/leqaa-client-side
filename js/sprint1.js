const egyptApi = {
   "القاهرة": {
      "Hadayek Al Zaiton	": "	حدائق الزيتون",
      "El Shorouk	": "	الشروق",
      "El Marg	": "	المرج",
      "Maadi Degla	": "	المعادي دجلة",
      "Abaseya	": "	العباسية",
      "New Nozha	": "	النزهة الجديدة",
      "Dar Al Salam	": "	دار السلام",
      "Al Kalaa	": "	القلعة",
      "Basateen	": "	البساتين",
      "Abdo Basha	": "	عبده باشا",
      "Nasr City	": "	مدينة ناصر",
      "15th Of May City	": "	مدينة 15 مايو",
      "5th Settlement	": "	التجمع الخامس",
      "Heliopolis	": "	مصر الجديدة",
      "3rd Settlement	": "	التجمع الثالث",
      "Ezbet El Nakhl	": "	عزبة النخل",
      "Katamiah	": "	قطامية",
      "El Herafieen	": "	الحرفيين",
      "15th of May City	": "	مدينة 15 مايو",
      "Down Town	": "	وسط البلد",
      "EL Marg	": "	المرج",
      "New Maadi	": "	المعادى الجديدة",
      "Zamalek	": "	الزمالك",
      "1st Settlement	": "	التجمع الاول",
      "Helwan	": "	حلوان",
      "Al Zeitoun	": "	الزيتون",
      "Masaken Sheraton	": "	مساكن شيراتون",
      "Hadayek Helwan	": "	حدائق حلوان",
      "Ghamrah	": "	غمره",
      "Rod El Farag	": "	روض الفرج",
      "Al Matareya	": "	المطرية",
      "Al Kasr Al Einy	": "	القصر العيني",
      "Cairo	": "	القاهرة",
      "New Cairo	": "	القاهرة الجديدة",
      "Ain Shams	": "	عين شمس",
      "Garden City	": "	جاردن سيتي",
      "Mirage City	": "	ميراج سيتى",
      "Amiria	": "	العامرية",
      "Al Azhar	": "	الأزهر",
      "Sayeda Zeinab	": "	السيدة زينب",
      "Almaza	": "	الماظة",
      "Fustat	": "	الفسطاط",
      "Hadayek Maadi	": "	حدائق المعادي",
      "Al Rehab	": "	الرحاب",
      "Al Moski	": "	الموسكي",
      "Manial Al Rodah	": "	منيل الروضة",
      "Maadi	": "	المعادى",
      "El Tahrir	": "	التحرير",
      "New El Marg	": "	نيو المرج",
      "Gesr Al Suez	": "	جسر السويس",
      "Abdeen	": "	عابدين",
      "Mokattam	": "	المقطم",
      "Al Salam City	": "	مدينة السلام",
      "Misr El Kadima	": "	مصر القديمة",
      "Helmiet Elzaitoun	": "	حلمية الزيتون",
      "Al Daher	": "	الضاهر",
      "Hadayek Al Qobah	": "	حدائق القبة",
      "Shubra	": "	شبرا",
      "Cornish Al Nile	": "	كورنيش النيل",
      "Badr City	": "	مدينة بدر",
      "Ramsis	": "	رمسيس",
      "Madinty	": "	مدينتي",
      "Helmeya	": "	الحلمية"
   },
   "الجيزة": {
      "6th of October	": "	السادس من اكتوبر",
      "Mansoureya	": "	المنصورية",
      "Hawamdya	": "	الحوامدية",
      "Tirsa	": "	تيرسا",
      "Abou Rawash	": "	ابو رواش",
      "Omraneya	": "	العمرانية",
      "Smart Village	": "	القرية الذكية",
      "Kerdasa	": "	كرداسة",
      "Saft El Laban	": "	صفط اللبن",
      "Dokki	": "	الدقي",
      "Al Saf	": "	الصف",
      "Sheikh Zayed	": "	الشيخ زايد",
      "Sakiat Mekki	": "	ساقية مكي",
      "Mohandessin	": "	المهندسين",
      "Al Kom Al Ahmer	": "	الكوم الأحمر",
      "Imbaba	": "	إمبابة",
      "Bolak Al Dakrour	": "	بولاق الدكرور",
      "Al Monib	": "	المنيب",
      "Berak Alkiaam	": "	برك الكيام",
      "Al Moatamadia	": "	المعتمدية",
      "Shabramant	": "	شبرامانت",
      "Warraq	": "	الوراق",
      "Giza	": "	الجيزة",
      "Manial	": "	المنيل",
      "Haram	": "	الهرم",
      "Agouza	": "	العجوزة",
      "Qism el Giza	": "	قسم الجيزة",
      "Faisal	": "	فيصل",
      "Al Wahat	": "	الواحات",
      "Hadayeq El Ahram	": "	حدائق الاهرام",
      "6th Of October	": "	السادس من اكتوبر",
      "Aossim	": "	أوسيم",
      "Al Nobariah	": "	النوبارية",
      "Badrashin	": "	بدراشين",
      "Kit Kat	": "	كت كات",
      "Al Barageel	": "	البراجيل",
      "Al Manashi	": "	المناشي"
   },
   "الاسكندرية": {
      "Miami	": "	ميامي",
      "Smouha	": "	سموحة",
      "Abees	": "	أبيس",
      "Alexandria	": "	الإسكندرية",
      "Sedi Gaber	": "	سيدي جابر",
      "El Borg El Kadem	": "	البرج القديم",
      "Sedi Bisher	": "	سيدي بشر",
      "Al Bitash	": "	البيطاش",
      "Stanly	": "	ستانلي",
      "El-Agamy	": "	العجمي",
      "San Stefano	": "	سان ستيفانو",
      "Mahtet El-Raml	": "	محطة الرمل",
      "Al A'mriah	": "	العامرية",
      "Bangar EL Sokar	": "	بنجر السكر",
      "Manshia	": "	المنشية",
      "Sedi Kreir	": "	سيدي كرير",
      "Kafer Abdou	": "	كفر عبده",
      "Borg El Arab	": "	برج العرب",
      "Roshdy	": "	رشدي",
      "Abu Keer	": "	ابو قير",
      "Glem	": "	جليم",
      "Al Nahda Al Amria	": "	النهضة العامرية",
      "Awaied-Ras Souda	": "	عويد راس سودا",
      "Mandara	": "	المندرة",
      "City Center	": "	وسط المدينة",
      "Azarita	": "	أزاريتا",
      "Maamora	": "	المعمورة",
      "Al Soyof	": "	السيوف",
      "Sporting	": "	سبورتنج",
      "Khorshid	": "	خورشيد",
      "Luran	": "	لوران",
      "Asafra	": "	العصافرة",
      "Zezenya	": "	زيزينيا",
      "Muntazah	": "	المنتزه"
   },
   "البحيرة": {
      "Hosh Issa	": "	حوش عيسى",
      "Rashid	": "	رشيد",
      "Shubrakhit	": "	شبراخيت",
      "Edko	": "	إدكو",
      "Damanhour	": "	دمنهور",
      "Etay Al Barud	": "	ايتاي البارود",
      "Al Beheira	": "	البحيرة",
      "Abu Hummus	": "	ابو حمص",
      "Kom Hamadah	": "	كوم حمادة",
      "Abou Al Matamer	": "	ابو المطامير",
      "Al Delengat	": "	الدلنجات",
      "El Nubariyah	": "	النوبارية",
      "Kafr El Dawwar	": "	كفر الدوار",
      "Edfina	": "	إدفينا",
      "Wadi Al Natroun	": "	وادي النطرون",
      "Al Mahmoudiyah	": "	المحمودية",
      "Al Rahmaniyah	": "	الرحمانية"
   },
   "الدقهلية": {
      "Meet Ghamr	": "	ميت غمر",
      "Belqas	": "	بلقاس",
      "Nabroo	": "	نابرو",
      "Manzala	": "	المنزلة",
      "Shrbeen	": "	شربين",
      "Al Daqahliya	": "	الدقهلية",
      "El Sinblaween	": "	السنبلاوين",
      "Menit El Nasr	": "	منية النصر",
      "Dekernes	": "	دكرنس",
      "Aga	": "	آغا",
      "Talkha	": "	طلخا",
      "Al Mansoura	": "	المنصورة",
   },
   "الفيوم": {
      "Sonores	": "	سنورس",
      "Ebshoy	": "	إبشواي",
      "Kofooer Elniel	": "	كفور النيل",
      "New Fayoum	": "	الفيوم الجديدة",
      "Atsa	": "	اطسا",
      "Sanhoor	": "	سنهور",
      "Tameaa	": "	طامية",
      "Al Fayoum	": "	الفيوم",
      "Sersenaa	": "	سيرسينا",
      "El Aagamen	": "	العجمين",
      "Manshaa Abdalla	": "	منشاء عبد الله",
      "Youssef Sadek	": "	يوسف صادق",
      "Manshaa Elgamal	": "	منشأة الجمال"
   },
   "الغربية": {
      "Alsanta	": "	السنطة",
      "Al Mahala Al Kobra	": "	المحلة الكبرى",
      "Al Gharbia	": "	الغربية",
      "Samanood	": "	سمنود",
      "Tanta	": "	طنطا",
      "Qotoor	": "	قطور",
      "Zefta	": "	زفتى",
      "Basyoon	": "	بسيون",
      "Kafr Alziat	": "	كفر الزيات"
   },
   "المنيا": {
      "Minya	": "	المنيا",
      "Samaloot	": "	سمالوط",
      "Eladwa	": "	العدوة",
      "Mghagha	": "	مغاغة",
      "Matai	": "	مطاى",
      "Malawi	": "	ملاوي",
      "Bani Mazar	": "	بني مزار",
      "Dermwas	": "	ديرماس",
      "Abo Korkas	": "	ابو قرقاص"
   },
   "المنوفية": {
      "Shohada	": "	الشهداء",
      "Menoof	": "	منوف",
      "Tala	": "	تلا",
      "Shebin El Koom	": "	شبين الكوم",
      "Sadat City	": "	مدينة السادات",
      "Al Monufia	": "	المنوفية",
      "Quesna	": "	قويسنا",
      "Berket Al Sabei	": "	بركة السبع",
      "Ashmoon	": "	أشمون"
   },
   "الشرقية": {
      "Al Salhiya Al Gedida	": "	الصالحية الجديدة",
      "Abu Hammad	": "	ابو حماد",
      "Abu Kbeer	": "	ابو كبير",
      "Hehya	": "	ههيا",
      "Awlad Saqr	": "	اولاد صقر",
      "Al Hasiniya	": "	الحسينية",
      "Faqous	": "	فاقوس",
      "Darb Negm	": "	درب نجم",
      "Al Ibrahimiya	": "	الابراهيمية",
      "Zakazik	": "	الزقازيق",
      "Kafr Saqr	": "	كفر صقر",
      "Mashtool Al Sooq	": "	مشتول السوق",
      "Belbes	": "	بيلبيس",
      "Meniya Alqamh	": "	منيا القمه",
      "Al Sharqia	": "	الشرقية",
      "10th of Ramdan City	": "	العاشر من رمضان"
   },
   "اسوان": {
      "Aswan	": "	أسوان",
      "Draw	": "	دراو",
      "El Klabsha	": "	كلابشة",
      "Al Sad Al Aali	": "	السد العالي",
      "Abu Simbel	": "	أبو سمبل",
      "Nasr Elnoba	": "	نصر النوبة",
      "Edfo	": "	إدفو",
      "Markaz Naser	": "	مركز ناصر",
      "Kom Ombo	": "	كوم امبو"
   },
   "اسيوط": {
      "Dayrout	": "	ديروط",
      "Asyut	": "	أسيوط",
      "El Qusya	": "	القوصية",
      "Assuit Elgdeda	": "	اسيوط الجديدة",
      "Elfath	": "	الفتح",
      "El Ghnayem	": "	الغنايم",
      "Sahel Selim	": "	ساحل سليم",
      "Abnoub	": "	أبنوب",
      "El Badari	": "	البدارى",
      "Abou Teag	": "	ابو تيج",
      "Serfa	": "	سيرفا",
      "Manflout	": "	منفلوط"
   },
   "بني سويف": {
      "Bani Souaif	": "	بني سويف",
      "El Wastaa	": "	الواسطى",
      "El Korimat	": "	الكريمات",
      "El Fashn	": "	الفشن",
      "Naser	": "	ناصر",
      "Ahnaseaa	": "	إهناسيا",
      "New Bani Souaif	": "	بني سويف الجديدة",
      "Bebaa	": "	ببا",
      "Smostaa	": "	سمسطا"
   },
   "دمياط": {
      "Kafr Saad	": "	كفر سعد",
      "Ras El Bar	": "	رأس البر",
      "Fareskor	": "	فارسكور",
      "Al Zarkah	": "	الزرقا",
      "Damietta	": "	دمياط",
      "New Damietta	": "	دمياط الجديدة"
   },
   "اسماعيلية": {
      "Elsalhia Elgdida	": "	الصالحية الجديدة",
      "Al Kasaseen	": "	القصاصين",
      "Abo Sultan	": "	ابو سلطان",
      "El Tal El Kebir	": "	التل الكبير",
      "Abu Swer	": "	ابو صوير",
      "Qantara Gharb	": "	قنطرة غرب",
      "Qantara Sharq	": "	القنطرة شرق",
      "Nfeesha	": "	نفيشة",
      "Ismailia	": "	الإسماعيلية",
      "Srabioom	": "	سرابيوم",
      "Fayed	": "	فايد"
   },
   "كفر الشيخ": {
      "Hamool	": "	الحامول",
      "Kafr El Sheikh	": "	كفر الشيخ",
      "Al Riadh	": "	الرياض",
      "Qeleen	": "	قلين",
      "Desouq	": "	دسوق",
      "Seedy Salem	": "	سيدى سالم",
      "Bela	": "	بيلا",
      "Fooh	": "	فوه",
      "Metobas	": "	مطوبس",
      "Borollos	": "	برج البرلس",
      "Balteem	": "	بلطيم"
   },
   "الاقصر": {
      "El Karnak	": "	الكرنك",
      "El Korna	": "	القرنة",
      "Armant Sharq	": "	ارمنت شرق",
      "Esnaa	": "	اسنا",
      "Luxor	": "	الأقصر",
      "Armant Gharb	": "	ارمنت غرب"
   },
   "مطروح": {
      "Matrooh	": "	مطروح",
      "El Alamein	": "	العلمين",
      "Sidi Abdel Rahman	": "	سيدي عبد الرحمن",
      "El Dabaa	": "	الضبعة",
      "Marsa Matrooh	": "	مرسى مطروح"
   },
   "الوادي الجديد": {
      "El Kharga	": "	الخارجة",
      "New Valley	": "	الوادي الجديد"
   },
   "بور سعيد": {
      "Port Fouad	": "	بور فؤاد",
      "Port Said	": "	بورسعيد",
      "Zohoor District	": "	حي الزهور",
   },
   "القليوبية": {
      "Abu Zaabal	": "	ابو زعبل",
      "Qaha	": "	قها",
      "Tookh	": "	طوخ",
      "El Oboor	": "	العبور",
      "Meet Nama	": "	ميت نما",
      "Al Shareaa Al Gadid	": "	الشريعة الجديد",
      "Banha	": "	بنها",
      "El Kanater EL Khayrya	": "	القناطر الخيرية",
      "Sheben Alkanater	": "	شبين القناطر",
      "El Qalag	": "	القلج",
      "Bahteem	": "	بهتيم",
      "Qalyubia	": "	القليوبية",
      "Orabi	": "	عرابي",
      "Qalyoob	": "	قليوب",
      "Al Khanka	": "	الخانكة",
      "El Khsos	": "	الخصوص",
      "Kafr Shokr	": "	كفر شكر",
      "Om Bayoumi	": "	أم بيومي",
      "Shoubra Alkhema	": "	شبرا الخيمة",
      "Mostorod	": "	مسطرد"
   },
   "قنا": {
      "Deshna	": "	دشنا",
      "Abu Tesht	": "	ابوتشت",
      "Farshoot	": "	فرشوط",
      "Qena	": "	قنا",
      "Qoos	": "	قوص",
      "Naqada	": "	نقادة",
      "Naga Hamadi	": "	نجع حمادي"
   },
   "البحر الاحمر": {
      "Red Sea	": "	البحر الاحمر",
      "Safaga	": "	سفاجا",
      "Hurghada	": "	الغردقة",
      "Qouseir	": "	القصير",
      "Marsa Alam	": "	مرسى علم",
      "Gouna	": "	الجونة",
      "Ras Ghareb	": "	رأس غارب"
   },
   "سوهاج": {
      "Sohag	": "	سوهاج",
      "Tema	": "	طما",
      "Saqatlah	": "	ساقلته",
      "Dar Elsalam	": "	دار السلام",
      "Gerga	": "	جرجا",
      "Elbalyna	": "	البالينا",
      "Maragha	": "	مراغة",
      "El Monshah	": "	المنشاه",
      "Ghena	": "	جهينة",
      "Akhmem	": "	أخميم",
      "Tahta	": "	طهطا"
   },
   "السويس": {
      "Ataka District	": "	حي عتاقة",
      "Suez	": "	السويس",
      "Elganaien District	": "	حي الجناين",
      "Al Suez	": "	السويس",
      "Al Adabya	": "	الأدبية",
      "Ain Al Sukhna	": "	العين السخنة",
      "El Arbeen District	": "	حى الاربعين"
   },
   "شمال سيناء": {
      "North Sinai	": "	شمال سيناء",
      "Al Arish	": "	العريش"
   },
   "جنوب سيناء": {
      "Neweibaa	": "	نويبع",
      "Dahab	": "	دهب",
      "Saint Catherine	": "	سانت كاترين",
      "Sharm Al Sheikh	": "	شرم الشيخ",
      "Toor Sinai	": "	طور سيناء",
      "Taba	": "	طابا"
   },
}

const governorateSelect = document.getElementById('governorate');
for (gover in egyptApi) {
   const option = document.createElement('option');
   option.value = gover;
   option.textContent = gover;
   governorateSelect.appendChild(option);
}
governorateSelect.addEventListener('change', populateCitiesOptions);

function populateCitiesOptions() {
   const selectedGovernorate = governorateSelect.value;
   console.log(governorateSelect.value)
   const citySelect = document.getElementById('city');

   citySelect.innerHTML = '<option value="">اختر مدينة</option>';

   if (selectedGovernorate) {
      const cities = egyptApi[selectedGovernorate];
      for (city in cities) {
         const option = document.createElement('option');
         option.value = cities[city];
         option.textContent = cities[city];
         citySelect.appendChild(option);
      }
   }
}

const completeRegistration = document.querySelector('.completeRegistration');
const loadingBody = document.querySelector('.loadingBody');

//-------------------------------------------------------------------------
const errorCon = document.createElement('error');
const completeRedData = async (formData) => {
   const response = await fetch('http://localhost:3000/api/v1/auth/sprint1', {
      method: 'POST',
      body: formData,
      credentials: 'include',
   })
   const message = await response.json()
   if (!response.ok || message.status == 400 ) {
      const messages = message?.message || ["Unknown error"];

      error.innerHTML = messages;
      error.style.paddingTop = "20px";
      error.style.paddingBottom = "20px";
      error.style.fontSize = "25px";
      completeRegistration.style.display = 'block';
      loadingBody.style.display = 'none';
      throw new Error(`Error during signup: ${messages}`);
   } else {
      error.innerHTML = "";
      window.location.href =
      `sprint2.html`;
   }
   return message;
}  
const completeRegistrationForm = document.getElementById("completeRegistration");
completeRegistrationForm.addEventListener("submit", async (e) => {

   e.preventDefault();
   const firstName = document.getElementById('firstName').value;
   const midName = document.getElementById('midName').value;
   const lastName = document.getElementById('lastName').value;
   const age = document.getElementById('age').value;
   const gender = document.getElementById('gender').value;
   const DOB = document.getElementById('DOB').value;
   const nationality = document.getElementById('nationality').value;
   const governorate = document.getElementById('governorate').value;
   const city = document.getElementById('city').value;
   const region = document.getElementById('region').value;
   const address = document.getElementById('address').value;
   const phone = document.getElementById('phone').value;
   
   const formData = new FormData();
   formData.append('firstName', firstName);
   formData.append('midName', midName);
   formData.append('lastName', lastName);
   formData.append('age', age);
   formData.append('gender', gender);
   formData.append('DOB', DOB);
   formData.append('nationality', nationality);
   formData.append('governorate', governorate);
   formData.append('city', city);
   formData.append('region', region);
   formData.append('address', address);
   formData.append('phone', phone);
   completeRegistration.style.display = 'none';
   loadingBody.style.display = 'grid';
   await completeRedData(formData);
})

const warnings = document.getElementById('warning');
const getWarning = async () => {
   const response = await fetch('http://localhost:3000/api/v1/auth/warning', {
      method: 'GET',
      credentials: 'include',
   })
   const data = await response.text();
   if (data != "") {
      warnings.innerHTML = `
      <span style = "color: black">برجاء استيفاء تلك الملاحظات:</span>
      <br>
      ${data}
      `;
      warnings.style.display = "block";
      const user = await userApi();
      document.getElementById('firstName').value = user.firstName;
      document.getElementById('midName').value = user.midName;
      document.getElementById('lastName').value = user.lastName;
      document.getElementById('age').value = user.age;
      document.getElementById('gender').value = user.gender;
      document.getElementById('DOB').value = new Date(user.DOB).toISOString().slice(0, 10);
      document.getElementById('nationality').value = user.nationality;
      document.getElementById('governorate').value = user.governorate;
      governorateSelect.dispatchEvent(new Event('change'))
      document.getElementById('city').value = user.city;
      document.getElementById('region').value = user.region;
      document.getElementById('address').value = user.address;
      document.getElementById('phone').value = user.phone;
   }
}
getWarning()

//-------------------------------------------------------------------------------------------------------------------
// fetch user data
const userApi = async () => {
   const response = await fetch(`http://localhost:3000/api/v1/user/profile`, {
      method: 'GET',
      headers: {
         "Content-Type": "application/json",
      },
      credentials: 'include'
   })

   if (!response.ok) {
      const errorData = await response.json();
      const messages = errorData?.message || ["Unknown error"];
      error.innerHTML = messages;
      throw new Error(`Error during signup: ${messages}`);
   }
   const message = await response.json();
   console.log(message.faceImage)
   return message;
}

//-------------------------------------------------------------------------------------------------------------------
// fetch user data
function convertDate(dateString) {
   const [year, month, day] = dateString.split("/");
   const dateObject = new Date(year, month - 1, day);
   return dateObject;
}


