const egyptApi = {
   "القاهرة": {
      "Hadayek Al Zaiton	": "	حدائق الزيتون",
      "El Shorouk	": "	الشروق",
      "El Marg	": "	المرج",
      "Maadi Degla	": "	المعادي دجلة",
      "Abaseya	": "	العباسية",
      "New Nozha	": "	النزهة الجديدة",
      "Dar Al Salam	": "	دار السلام",
      "Al Kalaa	": "	القلعة",
      "Basateen	": "	البساتين",
      "Abdo Basha	": "	عبده باشا",
      "Nasr City	": "	مدينة ناصر",
      "15th Of May City	": "	مدينة 15 مايو",
      "5th Settlement	": "	التجمع الخامس",
      "Heliopolis	": "	مصر الجديدة",
      "3rd Settlement	": "	التجمع الثالث",
      "Ezbet El Nakhl	": "	عزبة النخل",
      "Katamiah	": "	قطامية",
      "El Herafieen	": "	الحرفيين",
      "15th of May City	": "	مدينة 15 مايو",
      "Down Town	": "	وسط البلد",
      "EL Marg	": "	المرج",
      "New Maadi	": "	المعادى الجديدة",
      "Zamalek	": "	الزمالك",
      "1st Settlement	": "	التجمع الاول",
      "Helwan	": "	حلوان",
      "Al Zeitoun	": "	الزيتون",
      "Masaken Sheraton	": "	مساكن شيراتون",
      "Hadayek Helwan	": "	حدائق حلوان",
      "Ghamrah	": "	غمره",
      "Rod El Farag	": "	روض الفرج",
      "Al Matareya	": "	المطرية",
      "Al Kasr Al Einy	": "	القصر العيني",
      "Cairo	": "	القاهرة",
      "New Cairo	": "	القاهرة الجديدة",
      "Ain Shams	": "	عين شمس",
      "Garden City	": "	جاردن سيتي",
      "Mirage City	": "	ميراج سيتى",
      "Amiria	": "	العامرية",
      "Al Azhar	": "	الأزهر",
      "Sayeda Zeinab	": "	السيدة زينب",
      "Almaza	": "	الماظة",
      "Fustat	": "	الفسطاط",
      "Hadayek Maadi	": "	حدائق المعادي",
      "Al Rehab	": "	الرحاب",
      "Al Moski	": "	الموسكي",
      "Manial Al Rodah	": "	منيل الروضة",
      "Maadi	": "	المعادى",
      "El Tahrir	": "	التحرير",
      "New El Marg	": "	نيو المرج",
      "Gesr Al Suez	": "	جسر السويس",
      "Abdeen	": "	عابدين",
      "Mokattam	": "	المقطم",
      "Al Salam City	": "	مدينة السلام",
      "Misr El Kadima	": "	مصر القديمة",
      "Helmiet Elzaitoun	": "	حلمية الزيتون",
      "Al Daher	": "	الضاهر",
      "Hadayek Al Qobah	": "	حدائق القبة",
      "Shubra	": "	شبرا",
      "Cornish Al Nile	": "	كورنيش النيل",
      "Badr City	": "	مدينة بدر",
      "Ramsis	": "	رمسيس",
      "Madinty	": "	مدينتي",
      "Helmeya	": "	الحلمية"
   },
   "الجيزة": {
      "6th of October	": "	السادس من اكتوبر",
      "Mansoureya	": "	المنصورية",
      "Hawamdya	": "	الحوامدية",
      "Tirsa	": "	تيرسا",
      "Abou Rawash	": "	ابو رواش",
      "Omraneya	": "	العمرانية",
      "Smart Village	": "	القرية الذكية",
      "Kerdasa	": "	كرداسة",
      "Saft El Laban	": "	صفط اللبن",
      "Dokki	": "	الدقي",
      "Al Saf	": "	الصف",
      "Sheikh Zayed	": "	الشيخ زايد",
      "Sakiat Mekki	": "	ساقية مكي",
      "Mohandessin	": "	المهندسين",
      "Al Kom Al Ahmer	": "	الكوم الأحمر",
      "Imbaba	": "	إمبابة",
      "Bolak Al Dakrour	": "	بولاق الدكرور",
      "Al Monib	": "	المنيب",
      "Berak Alkiaam	": "	برك الكيام",
      "Al Moatamadia	": "	المعتمدية",
      "Shabramant	": "	شبرامانت",
      "Warraq	": "	الوراق",
      "Giza	": "	الجيزة",
      "Manial	": "	المنيل",
      "Haram	": "	الهرم",
      "Agouza	": "	العجوزة",
      "Qism el Giza	": "	قسم الجيزة",
      "Faisal	": "	فيصل",
      "Al Wahat	": "	الواحات",
      "Hadayeq El Ahram	": "	حدائق الاهرام",
      "6th Of October	": "	السادس من اكتوبر",
      "Aossim	": "	أوسيم",
      "Al Nobariah	": "	النوبارية",
      "Badrashin	": "	بدراشين",
      "Kit Kat	": "	كت كات",
      "Al Barageel	": "	البراجيل",
      "Al Manashi	": "	المناشي"
   },
   "الاسكندرية": {
      "Miami	": "	ميامي",
      "Smouha	": "	سموحة",
      "Abees	": "	أبيس",
      "Alexandria	": "	الإسكندرية",
      "Sedi Gaber	": "	سيدي جابر",
      "El Borg El Kadem	": "	البرج القديم",
      "Sedi Bisher	": "	سيدي بشر",
      "Al Bitash	": "	البيطاش",
      "Stanly	": "	ستانلي",
      "El-Agamy	": "	العجمي",
      "San Stefano	": "	سان ستيفانو",
      "Mahtet El-Raml	": "	محطة الرمل",
      "Al A'mriah	": "	العامرية",
      "Bangar EL Sokar	": "	بنجر السكر",
      "Manshia	": "	المنشية",
      "Sedi Kreir	": "	سيدي كرير",
      "Kafer Abdou	": "	كفر عبده",
      "Borg El Arab	": "	برج العرب",
      "Roshdy	": "	رشدي",
      "Abu Keer	": "	ابو قير",
      "Glem	": "	جليم",
      "Al Nahda Al Amria	": "	النهضة العامرية",
      "Awaied-Ras Souda	": "	عويد راس سودا",
      "Mandara	": "	المندرة",
      "City Center	": "	وسط المدينة",
      "Azarita	": "	أزاريتا",
      "Maamora	": "	المعمورة",
      "Al Soyof	": "	السيوف",
      "Sporting	": "	سبورتنج",
      "Khorshid	": "	خورشيد",
      "Luran	": "	لوران",
      "Asafra	": "	العصافرة",
      "Zezenya	": "	زيزينيا",
      "Muntazah	": "	المنتزه"
   },
   "البحيرة": {
      "Hosh Issa	": "	حوش عيسى",
      "Rashid	": "	رشيد",
      "Shubrakhit	": "	شبراخيت",
      "Edko	": "	إدكو",
      "Damanhour	": "	دمنهور",
      "Etay Al Barud	": "	ايتاي البارود",
      "Al Beheira	": "	البحيرة",
      "Abu Hummus	": "	ابو حمص",
      "Kom Hamadah	": "	كوم حمادة",
      "Abou Al Matamer	": "	ابو المطامير",
      "Al Delengat	": "	الدلنجات",
      "El Nubariyah	": "	النوبارية",
      "Kafr El Dawwar	": "	كفر الدوار",
      "Edfina	": "	إدفينا",
      "Wadi Al Natroun	": "	وادي النطرون",
      "Al Mahmoudiyah	": "	المحمودية",
      "Al Rahmaniyah	": "	الرحمانية"
   },
   "الدقهلية": {
      "Meet Ghamr	": "	ميت غمر",
      "Belqas	": "	بلقاس",
      "Nabroo	": "	نابرو",
      "Manzala	": "	المنزلة",
      "Shrbeen	": "	شربين",
      "Al Daqahliya	": "	الدقهلية",
      "El Sinblaween	": "	السنبلاوين",
      "Menit El Nasr	": "	منية النصر",
      "Dekernes	": "	دكرنس",
      "Aga	": "	آغا",
      "Talkha	": "	طلخا",
      "Al Mansoura	": "	المنصورة",
   },
   "الفيوم": {
      "Sonores	": "	سنورس",
      "Ebshoy	": "	إبشواي",
      "Kofooer Elniel	": "	كفور النيل",
      "New Fayoum	": "	الفيوم الجديدة",
      "Atsa	": "	اطسا",
      "Sanhoor	": "	سنهور",
      "Tameaa	": "	طامية",
      "Al Fayoum	": "	الفيوم",
      "Sersenaa	": "	سيرسينا",
      "El Aagamen	": "	العجمين",
      "Manshaa Abdalla	": "	منشاء عبد الله",
      "Youssef Sadek	": "	يوسف صادق",
      "Manshaa Elgamal	": "	منشأة الجمال"
   },
   "الغربية": {
      "Alsanta	": "	السنطة",
      "Al Mahala Al Kobra	": "	المحلة الكبرى",
      "Al Gharbia	": "	الغربية",
      "Samanood	": "	سمنود",
      "Tanta	": "	طنطا",
      "Qotoor	": "	قطور",
      "Zefta	": "	زفتى",
      "Basyoon	": "	بسيون",
      "Kafr Alziat	": "	كفر الزيات"
   },
   "المنيا": {
      "Minya	": "	المنيا",
      "Samaloot	": "	سمالوط",
      "Eladwa	": "	العدوة",
      "Mghagha	": "	مغاغة",
      "Matai	": "	مطاى",
      "Malawi	": "	ملاوي",
      "Bani Mazar	": "	بني مزار",
      "Dermwas	": "	ديرماس",
      "Abo Korkas	": "	ابو قرقاص"
   },
   "المنوفية": {
      "Shohada	": "	الشهداء",
      "Menoof	": "	منوف",
      "Tala	": "	تلا",
      "Shebin El Koom	": "	شبين الكوم",
      "Sadat City	": "	مدينة السادات",
      "Al Monufia	": "	المنوفية",
      "Quesna	": "	قويسنا",
      "Berket Al Sabei	": "	بركة السبع",
      "Ashmoon	": "	أشمون"
   },
   "الشرقية": {
      "Al Salhiya Al Gedida	": "	الصالحية الجديدة",
      "Abu Hammad	": "	ابو حماد",
      "Abu Kbeer	": "	ابو كبير",
      "Hehya	": "	ههيا",
      "Awlad Saqr	": "	اولاد صقر",
      "Al Hasiniya	": "	الحسينية",
      "Faqous	": "	فاقوس",
      "Darb Negm	": "	درب نجم",
      "Al Ibrahimiya	": "	الابراهيمية",
      "Zakazik	": "	الزقازيق",
      "Kafr Saqr	": "	كفر صقر",
      "Mashtool Al Sooq	": "	مشتول السوق",
      "Belbes	": "	بيلبيس",
      "Meniya Alqamh	": "	منيا القمه",
      "Al Sharqia	": "	الشرقية",
      "10th of Ramdan City	": "	العاشر من رمضان"
   },
   "اسوان": {
      "Aswan	": "	أسوان",
      "Draw	": "	دراو",
      "El Klabsha	": "	كلابشة",
      "Al Sad Al Aali	": "	السد العالي",
      "Abu Simbel	": "	أبو سمبل",
      "Nasr Elnoba	": "	نصر النوبة",
      "Edfo	": "	إدفو",
      "Markaz Naser	": "	مركز ناصر",
      "Kom Ombo	": "	كوم امبو"
   },
   "اسيوط": {
      "Dayrout	": "	ديروط",
      "Asyut	": "	أسيوط",
      "El Qusya	": "	القوصية",
      "Assuit Elgdeda	": "	اسيوط الجديدة",
      "Elfath	": "	الفتح",
      "El Ghnayem	": "	الغنايم",
      "Sahel Selim	": "	ساحل سليم",
      "Abnoub	": "	أبنوب",
      "El Badari	": "	البدارى",
      "Abou Teag	": "	ابو تيج",
      "Serfa	": "	سيرفا",
      "Manflout	": "	منفلوط"
   },
   "بني سويف": {
      "Bani Souaif	": "	بني سويف",
      "El Wastaa	": "	الواسطى",
      "El Korimat	": "	الكريمات",
      "El Fashn	": "	الفشن",
      "Naser	": "	ناصر",
      "Ahnaseaa	": "	إهناسيا",
      "New Bani Souaif	": "	بني سويف الجديدة",
      "Bebaa	": "	ببا",
      "Smostaa	": "	سمسطا"
   },
   "دمياط": {
      "Kafr Saad	": "	كفر سعد",
      "Ras El Bar	": "	رأس البر",
      "Fareskor	": "	فارسكور",
      "Al Zarkah	": "	الزرقا",
      "Damietta	": "	دمياط",
      "New Damietta	": "	دمياط الجديدة"
   },
   "اسماعيلية": {
      "Elsalhia Elgdida	": "	الصالحية الجديدة",
      "Al Kasaseen	": "	القصاصين",
      "Abo Sultan	": "	ابو سلطان",
      "El Tal El Kebir	": "	التل الكبير",
      "Abu Swer	": "	ابو صوير",
      "Qantara Gharb	": "	قنطرة غرب",
      "Qantara Sharq	": "	القنطرة شرق",
      "Nfeesha	": "	نفيشة",
      "Ismailia	": "	الإسماعيلية",
      "Srabioom	": "	سرابيوم",
      "Fayed	": "	فايد"
   },
   "كفر الشيخ": {
      "Hamool	": "	الحامول",
      "Kafr El Sheikh	": "	كفر الشيخ",
      "Al Riadh	": "	الرياض",
      "Qeleen	": "	قلين",
      "Desouq	": "	دسوق",
      "Seedy Salem	": "	سيدى سالم",
      "Bela	": "	بيلا",
      "Fooh	": "	فوه",
      "Metobas	": "	مطوبس",
      "Borollos	": "	برج البرلس",
      "Balteem	": "	بلطيم"
   },
   "الاقصر": {
      "El Karnak	": "	الكرنك",
      "El Korna	": "	القرنة",
      "Armant Sharq	": "	ارمنت شرق",
      "Esnaa	": "	اسنا",
      "Luxor	": "	الأقصر",
      "Armant Gharb	": "	ارمنت غرب"
   },
   "مطروح": {
      "Matrooh	": "	مطروح",
      "El Alamein	": "	العلمين",
      "Sidi Abdel Rahman	": "	سيدي عبد الرحمن",
      "El Dabaa	": "	الضبعة",
      "Marsa Matrooh	": "	مرسى مطروح"
   },
   "الوادي الجديد": {
      "El Kharga	": "	الخارجة",
      "New Valley	": "	الوادي الجديد"
   },
   "بور سعيد": {
      "Port Fouad	": "	بور فؤاد",
      "Port Said	": "	بورسعيد",
      "Zohoor District	": "	حي الزهور",
   },
   "القليوبية": {
      "Abu Zaabal	": "	ابو زعبل",
      "Qaha	": "	قها",
      "Tookh	": "	طوخ",
      "El Oboor	": "	العبور",
      "Meet Nama	": "	ميت نما",
      "Al Shareaa Al Gadid	": "	الشريعة الجديد",
      "Banha	": "	بنها",
      "El Kanater EL Khayrya	": "	القناطر الخيرية",
      "Sheben Alkanater	": "	شبين القناطر",
      "El Qalag	": "	القلج",
      "Bahteem	": "	بهتيم",
      "Qalyubia	": "	القليوبية",
      "Orabi	": "	عرابي",
      "Qalyoob	": "	قليوب",
      "Al Khanka	": "	الخانكة",
      "El Khsos	": "	الخصوص",
      "Kafr Shokr	": "	كفر شكر",
      "Om Bayoumi	": "	أم بيومي",
      "Shoubra Alkhema	": "	شبرا الخيمة",
      "Mostorod	": "	مسطرد"
   },
   "قنا": {
      "Deshna	": "	دشنا",
      "Abu Tesht	": "	ابوتشت",
      "Farshoot	": "	فرشوط",
      "Qena	": "	قنا",
      "Qoos	": "	قوص",
      "Naqada	": "	نقادة",
      "Naga Hamadi	": "	نجع حمادي"
   },
   "البحر الاحمر": {
      "Red Sea	": "	البحر الاحمر",
      "Safaga	": "	سفاجا",
      "Hurghada	": "	الغردقة",
      "Qouseir	": "	القصير",
      "Marsa Alam	": "	مرسى علم",
      "Gouna	": "	الجونة",
      "Ras Ghareb	": "	رأس غارب"
   },
   "سوهاج": {
      "Sohag	": "	سوهاج",
      "Tema	": "	طما",
      "Saqatlah	": "	ساقلته",
      "Dar Elsalam	": "	دار السلام",
      "Gerga	": "	جرجا",
      "Elbalyna	": "	البالينا",
      "Maragha	": "	مراغة",
      "El Monshah	": "	المنشاه",
      "Ghena	": "	جهينة",
      "Akhmem	": "	أخميم",
      "Tahta	": "	طهطا"
   },
   "السويس": {
      "Ataka District	": "	حي عتاقة",
      "Suez	": "	السويس",
      "Elganaien District	": "	حي الجناين",
      "Al Suez	": "	السويس",
      "Al Adabya	": "	الأدبية",
      "Ain Al Sukhna	": "	العين السخنة",
      "El Arbeen District	": "	حى الاربعين"
   },
   "شمال سيناء": {
      "North Sinai	": "	شمال سيناء",
      "Al Arish	": "	العريش"
   },
   "جنوب سيناء": {
      "Neweibaa	": "	نويبع",
      "Dahab	": "	دهب",
      "Saint Catherine	": "	سانت كاترين",
      "Sharm Al Sheikh	": "	شرم الشيخ",
      "Toor Sinai	": "	طور سيناء",
      "Taba	": "	طابا"
   },
}
let fullImages = [], updatedImages = [];


const governorateSelect = document.getElementById('governorate');
for (gover in egyptApi) {
   const option = document.createElement('option');
   option.value = gover;
   option.textContent = gover;
   governorateSelect.appendChild(option);
}
governorateSelect.addEventListener('change', populateCitiesOptions);

function populateCitiesOptions() {
   const selectedGovernorate = governorateSelect.value;
   console.log(governorateSelect.value)
   const citySelect = document.getElementById('city');


   // Clear any existing options
   citySelect.innerHTML = '<option value="">اختر مدينة</option>';

   // Add options for the selected governorate
   if (selectedGovernorate) {
      const cities = egyptApi[selectedGovernorate];
      for (city in cities) {
         const option = document.createElement('option');
         option.value = cities[city];
         option.textContent = cities[city];
         citySelect.appendChild(option);
      }
   }
}

const addLanguageButton = document.getElementById('addLanguageButton');
const completeRegistration = document.querySelector('.completeRegistration');
const loadingBody = document.querySelector('.loadingBody');

const initialLanguageSection = languagesSection.querySelector('.language-section');

addLanguageButton.addEventListener('click', () => {
   const newLanguageSection = initialLanguageSection.cloneNode(true);

   const newLanguageInputs = newLanguageSection.querySelectorAll('select');
   newLanguageInputs.forEach((input, index) => {
      const newInputName = input.name.replace(/\[[0-9]+\]/, `[${languagesSection.children.length}]`);
      input.name = newInputName;
   });

   const removeButton = document.createElement('button');
   removeButton.type = 'button';
   removeButton.classList.add('removeLanguageButton');
   removeButton.textContent = 'Remove';
   newLanguageSection.appendChild(removeButton);
   removeButton.style.display = 'block'

   removeButton.addEventListener('click', () => {
      languagesSection.removeChild(newLanguageSection);
   });

   languagesSection.appendChild(newLanguageSection);
});

//----------------------------------------------------------------------------------------------------------
const permanentDiseasesYes = document.getElementById('permanentDiseasesYes');
const permanentDiseasesNo = document.getElementById('permanentDiseasesNo');
const permanentDiseasesDetailsSection = document.getElementById('permanentDiseasesDetailsSection'); 4

permanentDiseasesYes.addEventListener('change', () => {
   permanentDiseasesDetailsSection.style.display = 'flex';
});

permanentDiseasesNo.addEventListener('change', () => {
   permanentDiseasesDetailsSection.style.display = 'none';
});

//----------------------------------------------------------------------------------------------------------
const disabilityDiseasesYes = document.getElementById('disabilityYes');
const disabilityNo = document.getElementById('disabilityNo');
const disabilityDetailsSection = document.getElementById('disabilityDetailsSection');

disabilityDiseasesYes.addEventListener('change', () => {
   disabilityDetailsSection.style.display = 'flex';
});

disabilityNo.addEventListener('change', () => {
   disabilityDetailsSection.style.display = 'none';
});

//----------------------------------------------------------------------------------------------------------
const carYes = document.getElementById('carYes');
const carNo = document.getElementById('carNo');
const carDetailsSection = document.getElementById('carDetailsSection');

carYes.addEventListener('change', () => {
   carDetailsSection.style.display = 'flex';
});

carNo.addEventListener('change', () => {
   carDetailsSection.style.display = 'none';
});

//----------------------------------------------------------------------------------------------------------
const apartmentYes = document.getElementById('apartmentYes');
const apartmentNo = document.getElementById('apartmentNo');
const apartmentDetailsSection = document.getElementById('apartmentDetailsSection');

apartmentYes.addEventListener('change', () => {
   apartmentDetailsSection.style.display = 'flex';
});

apartmentNo.addEventListener('change', () => {
   apartmentDetailsSection.style.display = 'none';
});

//----------------------------------------------------------------------------------------------------------
const businessOwnerYes = document.getElementById('businessOwnerYes');
const businessOwnerNo = document.getElementById('businessOwnerNo');
const businessOwnerSection = document.getElementById('businessOwnerSection');

businessOwnerYes.addEventListener('change', () => {
   businessOwnerSection.style.display = 'flex';
});

businessOwnerNo.addEventListener('change', () => {
   businessOwnerSection.style.display = 'none';
});

//----------------------------------------------------------------------------------------------------------
const jobYes = document.getElementById('jobYes');
const jobNo = document.getElementById('jobNo');
const jobSection = document.getElementById('jobSection');

jobYes.addEventListener('change', () => {
   jobSection.style.display = 'flex';
});

jobNo.addEventListener('change', () => {
   jobSection.style.display = 'none';
});

//----------------------------------------------------------------------------------------------------------
const childrenYes = document.getElementById('childrenYes');
const childrenNo = document.getElementById('childrenNo');
const childrenSection = document.getElementById('childrenSection');

childrenYes.addEventListener('change', () => {
   childrenSection.style.display = 'flex';
});

childrenNo.addEventListener('change', () => {
   childrenSection.style.display = 'none';
});


//----------------------------------------------------------------------------------------------------------
const faceImageInput = document.getElementById('faceImage');
const idImageInput = document.getElementById('idImage');
// const manWithIdImageInput = document.getElementById('manWithIdImage');
const faceImagePreview = document.getElementById('faceImagePreview');
const fullImagePreview = document.getElementById('fullImagePreview');
const idImagePreview = document.getElementById('idImagePreview');
// const manWithIdImagePreview = document.getElementById('manWithIdImagePreview');

function displayImagePreview(input, previewElement) {
   const file = input.files[0];
   if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
         previewElement.src = e.target.result;
      };
      reader.readAsDataURL(file);
   } else {
      previewElement.src = '';
   }
   return previewElement

}
faceImageInput.addEventListener('change', () => {
   const previewElement = document.createElement('img');
   const updatedPreviewElement = displayImagePreview(faceImageInput, previewElement);
   while (faceImagePreview.firstChild) {
      faceImagePreview.removeChild(faceImagePreview.firstChild);
   }
   faceImagePreview.appendChild(updatedPreviewElement);


});

counter = 1;
const fullImageSection = document.getElementById('fullImageSection')
const addFullImage = document.getElementById('addFullImage');
const initialFullImageSection = fullImageSection.querySelector('.image-section');
console.log(addFullImage)
addFullImage.addEventListener('click', () => {
   const newFullImageSection = initialFullImageSection.cloneNode(true);
   newFullImageSection.querySelector('.preview').id = `fullImagePreview${counter++}`
   if (newFullImageSection.querySelector('.preview').children.length > 0)
      newFullImageSection.querySelector('.preview').removeChild(newFullImageSection.querySelector('.preview').firstChild);
   newFullImageSection.querySelector('label').setAttribute('for', `fullImage${counter}`)
   console.log(newFullImageSection.querySelector('label'))
   const newFullImageInput = newFullImageSection.querySelector('input');
   newFullImageInput.id = `fullImage${counter}`
   newFullImageInput.value = null;

   const removeButton = document.createElement('button');
   removeButton.type = 'button';
   removeButton.classList.add('removeFullImageButton');
   removeButton.textContent = 'Remove';
   removeButton.style.display = 'block'
   removeButton.addEventListener('click', () => {
      fullImageSection.removeChild(newFullImageSection);
      if (fullImageSection.children.length < 5)
         addFullImage.disabled = false

   });
   newFullImageSection.appendChild(removeButton);
   fullImageSection.appendChild(newFullImageSection)

   const fullImageInputs = Array.from(document.querySelectorAll("input[type='file'].fullImage"));
   fullImageInputs.forEach((input, index) => {
      input.addEventListener("change", (event) => {
         const previewElement = document.createElement('img');
         const previewDiv = input.closest('.image-section').querySelector('.preview');
         const updatedPreviewElement = displayImagePreview(input, previewElement);
         while (previewDiv.firstChild) {
            previewDiv.removeChild(previewDiv.firstChild);
         }
         previewDiv.appendChild(updatedPreviewElement);
      });
   });
   if (fullImageSection.children.length == 5)
      addFullImage.disabled = true
})
const fullImageInputs = Array.from(document.querySelectorAll("input[type='file'].fullImage"));
fullImageInputs.forEach((input, index) => {
   input.addEventListener("change", (event) => {
      const previewElement = document.createElement('img');
      const previewDiv = input.closest('.image-section').querySelector('.preview');
      const updatedPreviewElement = displayImagePreview(input, previewElement);
      while (previewDiv.firstChild)
         previewDiv.removeChild(previewDiv.firstChild);
      previewDiv.appendChild(updatedPreviewElement);
   });
});

idImageInput.addEventListener('change', () => {
   const previewElement = document.createElement('img');
   const updatedPreviewElement = displayImagePreview(idImageInput, previewElement);
   while (idImagePreview.firstChild) {
      idImagePreview.removeChild(idImagePreview.firstChild);
      console.log(document.getElementById('idImage').files[0])
   }
   idImagePreview.appendChild(updatedPreviewElement);
});

// manWithIdImageInput.addEventListener('change', () => {
//    const previewElement = document.createElement('img');
//    const updatedPreviewElement = displayImagePreview(manWithIdImageInput, previewElement);
//    while (manWithIdImagePreview.firstChild) {
//       manWithIdImagePreview.removeChild(manWithIdImagePreview.firstChild);
//    }
//    manWithIdImagePreview.appendChild(updatedPreviewElement);
// });

//----------------------------------------------------------------------------------------------------------

const errorCon = document.createElement('error');
const completeRedData = async (formData) => {

   const languageSections = document.querySelectorAll('.language-section');
   let languages = [];
   languageSections.forEach((section, i) => {
      const language = section.querySelector(`select[name="languages[${i}].language"]`).value;
      const level = section.querySelector(`select[name="languages[${i}].level"]`).value;
      languages.push({ language, level });
   });
   const response = await fetch('http://localhost:3000/api/v1/auth/user', {
      method: 'POST',
      body: formData,
      credentials: 'include',
   })
   const message = await response.json()
   if (!response.ok || message.status == 400 ) {
      const messages = message?.message || ["Unknown error"];

      error.innerHTML = messages;
      error.style.paddingTop = "20px";
      error.style.paddingBottom = "20px";
      error.style.fontSize = "25px";
      completeRegistration.style.display = 'block';
      loadingBody.style.display = 'none';
      throw new Error(`Error during signup: ${messages}`);
   } else {
      error.innerHTML = "";
      window.location.href =
      `newUser.html`;
      alert("user registration completed successfully");
   }
   return message;
}
const completeRegistrationForm = document.getElementById("completeRegistration");
completeRegistrationForm.addEventListener("submit", async (e) => {

   e.preventDefault();
   const firstName = document.getElementById('firstName').value;
   const email = document.getElementById('email').value;
   const midName = document.getElementById('midName').value;
   const lastName = document.getElementById('lastName').value;
   const age = document.getElementById('age').value;
   const gender = document.getElementById('gender').value;
   const DOB = document.getElementById('DOB').value;
   const nationality = document.getElementById('nationality').value;
   const governorate = document.getElementById('governorate').value;
   const city = document.getElementById('city').value;
   const region = document.getElementById('region').value;
   const address = document.getElementById('address').value;
   const phone = document.getElementById('phone').value;
   const club = document.getElementById('club').value;
   const qualification = document.getElementById('qualification').value;
   const school = document.getElementById('school').value;
   const schoolType = document.getElementById('schoolType').value;
   const college = document.getElementById('college').value;
   const university = document.getElementById('university').value;
   const specialization = document.getElementById('specialization').value;
   const religion = document.getElementById('religion').value;
   const skinColor = document.getElementById('skin').value;
   const height = document.getElementById('height').value;
   const weight = document.getElementById('weight').value;
   const nameOfTheApplicantGuardian = document.getElementById('nameOfTheApplicantGuardian').value;
   const relationWithApplicant = document.getElementById('relationWithApplicant').value;
   const phoneOfGuardian = document.getElementById('phoneOfGuardian').value;
   const hobbies = document.getElementById('hobbies').value;
   const habbits = document.getElementById('habbits').value;
   const otherInfo = document.getElementById('otherInfo').value;
   const permanentDiseases = document.querySelector('input[name="permanentDiseases"]:checked').value;
   const permanentDiseasesDetails = document.getElementById('permanentDiseasesDetails').value;
   const disability = document.querySelector('input[name="disability"]:checked').value
   const disabilityDetails = document.getElementById('disabilityDetails').value;
   const car = document.querySelector('input[name="car"]:checked').value
   const carType = document.getElementById('carTypeDetails').value;
   const carModel = document.getElementById('carModelDetails').value;
   const apartment = document.querySelector('input[name="apartment"]:checked').value
   const space = document.getElementById('apartmentSpaceDetails').value;
   const site = document.getElementById('apartmentSiteDetails').value;
   const businessOwner = document.querySelector('input[name="businessOwner"]:checked').value
   const businessType = document.getElementById('businessType').value;
   const job = document.querySelector('input[name="job"]:checked').value
   const jobTitle = document.getElementById('jobTitleDetails').value;
   const jobCompany = document.getElementById('jobCompanyDetails').value;
   const marriedBefore = document.querySelector('input[name="marriedBefore"]:checked').value
   const marriedNow = document.querySelector('input[name="marriedNow"]:checked').value
   const children = document.querySelector('input[name="children"]:checked').value
   const numberOfChildren = document.getElementById('numberOfChildrenDetails').value;
   const agesOfChildren = document.getElementById('agesOfChildrenDetails').value;
   const livingAbroad = document.querySelector('input[name="livingAbroad"]:checked').value
   const languageSections = document.querySelectorAll('.language-section');
   let languages = [];
   languageSections.forEach((section, i) => {
      const language = section.querySelector(`select[name="languages[${i}].language"]`).value;
      const level = section.querySelector(`select[name="languages[${i}].level"]`).value;

      languages.push({ language, level });
   });
   const faceImage = document.getElementById('faceImage').files[0];
   const idImage = document.getElementById('idImage').files[0];
   const fullImageInputs = Array.from(document.querySelectorAll("input[type='file'].fullImage"));
   let full = [null, null, null, null, null];
   fullImageInputs.forEach((input, index) => {
      const previewImg = input.closest('.image-section').querySelector('.preview img');
      if (previewImg)
         if (fullImages.includes(previewImg.src)) {
            const i = fullImages.indexOf(previewImg.src)
            full[i] = undefined;
         }
   });
   fullImageInputs.forEach((input, index) => {
      const previewImg = input.closest('.image-section').querySelector('.preview img');
      if (previewImg)
         if (!fullImages.includes(previewImg.src))
            for (let i = 0; i < 5; i++) {
               if (full[i] === null) { full[i] = input.files[0]; break; };
            }
   });

   const formData = new FormData();
   formData.append('email', email);
   formData.append('firstName', firstName);
   formData.append('midName', midName);
   formData.append('lastName', lastName);
   formData.append('age', age);
   formData.append('gender', gender);
   formData.append('DOB', DOB);
   formData.append('nationality', nationality);
   formData.append('governorate', governorate);
   formData.append('city', city);
   formData.append('region', region);
   formData.append('address', address);
   formData.append('phone', phone);
   formData.append('club', club);
   formData.append('qualification', qualification);
   formData.append('school', school);
   formData.append('schoolType', schoolType);
   formData.append('college', college);
   formData.append('university', university);
   formData.append('specialization', specialization);
   formData.append('languages', JSON.stringify(languages));
   formData.append('religion', religion);
   formData.append('height', height);
   formData.append('weight', weight);
   formData.append('skinColor', skinColor);
   formData.append('permanentDiseases', permanentDiseases);
   formData.append('permanentDiseasesDetails', permanentDiseasesDetails);
   formData.append('disability', disability);
   formData.append('disabilityDetails', disabilityDetails);
   formData.append('car', car);
   formData.append('carType', carType);
   formData.append('carModel', carModel);
   formData.append('apartment', apartment);
   formData.append('space', space);
   formData.append('site', site);
   formData.append('businessOwner', businessOwner);
   formData.append('businessType', businessType);
   formData.append('job', job);
   formData.append('jobTitle', jobTitle);
   formData.append('jobCompany', jobCompany);
   formData.append('marriedBefore', marriedBefore);
   formData.append('marriedNow', marriedNow);
   formData.append('children', children);
   formData.append('numberOfChildren', numberOfChildren);
   formData.append('agesOfChildren', agesOfChildren);
   formData.append('nameOfTheApplicantGuardian', nameOfTheApplicantGuardian);
   formData.append('relationWithApplicant', relationWithApplicant);
   formData.append('phoneOfGuardian', phoneOfGuardian);
   formData.append('hobbies', hobbies);
   formData.append('habbits', habbits);
   formData.append('otherInfo', otherInfo);
   formData.append('livingAbroad', livingAbroad);
   formData.append('fullImage1', full[0]);
   formData.append('fullImage2', full[1]);
   formData.append('fullImage3', full[2]);
   formData.append('fullImage4', full[3]);
   formData.append('fullImage5', full[4]);

   if (faceImage != undefined)
      formData.append('faceImage', faceImage);
   if (idImage !== undefined)
      formData.append('idImage', idImage);
   try {
      completeRegistration.style.display = 'none';
      loadingBody.style.display = 'grid';
      const res = await completeRedData(formData);

      // document.getElementById('firstName').innerHTML='';
      // document.getElementById('email').innerHTML='';
      // document.getElementById('midName').innerHTML='';
      // document.getElementById('lastName').innerHTML='';
      // document.getElementById('age').innerHTML='';
      // document.getElementById('gender').innerHTML='';
      // document.getElementById('DOB').innerHTML='';
      // document.getElementById('nationality').innerHTML='';
      // document.getElementById('governorate').innerHTML='';
      // document.getElementById('city').innerHTML='';
      // document.getElementById('region').innerHTML='';
      // document.getElementById('address').innerHTML='';
      // document.getElementById('phone').innerHTML='';
      // document.getElementById('club').innerHTML='';
      // document.getElementById('qualification').innerHTML='';
      // document.getElementById('school').innerHTML='';
      // document.getElementById('schoolType').innerHTML='';
      // document.getElementById('college').innerHTML='';
      // document.getElementById('university').innerHTML='';
      // document.getElementById('specialization').innerHTML='';
      // document.getElementById('religion').innerHTML='';
      // document.getElementById('skin').innerHTML='';
      // document.getElementById('height').innerHTML='';
      // document.getElementById('weight').innerHTML='';
      // document.getElementById('nameOfTheApplicantGuardian').innerHTML='';
      // document.getElementById('relationWithApplicant').innerHTML='';
      // document.getElementById('phoneOfGuardian').innerHTML='';
      // document.getElementById('hobbies').innerHTML='';
      // document.getElementById('habbits').innerHTML='';
      // document.getElementById('otherInfo').innerHTML='';
      // document.querySelector('input[name="permanentDiseases"]').checked = false;
      // document.getElementById('permanentDiseasesDetails').innerHTML = '';
      // document.querySelector('input[name="disability"]').checked = false
      // document.getElementById('disabilityDetails').innerHTML = '';
      // document.querySelector('input[name="car"]').checked = false
      // document.getElementById('carTypeDetails').innerHTML='';
      // document.getElementById('carModelDetails').innerHTML='';
      // document.querySelector('input[name="apartment"]').checked = false
      // document.getElementById('apartmentSpaceDetails').innerHTML='';
      // document.getElementById('apartmentSiteDetails').innerHTML='';
      // document.querySelector('input[name="businessOwner"]').checked = false
      // document.getElementById('businessType').innerHTML='';
      // document.querySelector('input[name="job"]').checked = false
      // document.getElementById('jobTitleDetails').innerHTML='';
      // document.getElementById('jobCompanyDetails').innerHTML='';
      // document.querySelector('input[name="marriedBefore"]').checked = false
      // document.querySelector('input[name="marriedNow"]').checked = false
      // document.querySelector('input[name="children"]').checked = false
      // document.getElementById('numberOfChildrenDetails').innerHTML='';
      // document.getElementById('agesOfChildrenDetails').innerHTML='';
      // document.querySelector('input[name="livingAbroad"]').checked = false
      // document.querySelectorAll('.language-section');
   } catch (err) {
      throw new Error(err)
   }
})

//-------------------------------------------------------------------------------------------------------------------
// convert date
function convertDate(dateString) {
   const [year, month, day] = dateString.split("/");
   const dateObject = new Date(year, month - 1, day);
   return dateObject;
}

//-------------------------------------------------------------------------------------------------------------------
// update guardian fields
const gender = document.getElementById("gender");
const guardianNameInput = document.getElementById('nameOfTheApplicantGuardian');
const relationInput = document.getElementById('relationWithApplicant');
const phoneInput = document.getElementById('phoneOfGuardian');
function updateGuardianFields() {
   if (gender.value === "ذكر") {
      guardianNameInput.disabled = true;
      relationInput.disabled = true;
      phoneInput.disabled = true;
      guardianNameInput.required = false;
      relationInput.required = false;
      phoneInput.required = false;
   } else {
      guardianNameInput.disabled = false;
      relationInput.disabled = false;
      phoneInput.disabled = false;
      guardianNameInput.required = true;
      relationInput.required = true;
      phoneInput.required = true;
   }
}
gender.addEventListener('change', updateGuardianFields);



